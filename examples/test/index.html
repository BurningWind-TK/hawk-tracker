<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hawk Tracker - 性能监控演示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .demo-section h3 {
            color: #555;
            margin-top: 0;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .performance-info {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .error-btn {
            background-color: #dc3545;
        }
        .error-btn:hover {
            background-color: #c82333;
        }
        .performance-btn {
            background-color: #28a745;
        }
        .performance-btn:hover {
            background-color: #218838;
        }
        .resource-btn {
            background-color: #ffc107;
            color: #212529;
        }
        .resource-btn:hover {
            background-color: #e0a800;
        }
        .metric-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .metric-label {
            font-weight: bold;
            color: #555;
        }
        .metric-value {
            color: #007bff;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hawk Tracker - 性能监控演示</h1>
        
        <div class="demo-section">
            <h3>性能监控测试</h3>
            <p>页面加载时会自动收集性能数据，包括：</p>
            <ul>
                <li>页面加载时间</li>
                <li>DOM 内容加载时间</li>
                <li>首次绘制时间</li>
                <li>网络请求时间</li>
                <li>DNS 查询时间</li>
                <li>TCP 连接时间</li>
            </ul>
            <div class="performance-info" id="performanceInfo">
                <strong>性能数据将在页面加载完成后显示...</strong>
            </div>
        </div>

        <div class="demo-section">
            <h3>功能测试</h3>
            <button id="errorBtn" class="error-btn">触发错误</button>
            <button id="performanceBtn" class="performance-btn">手动收集性能数据</button>
            <button id="resourceBtn" class="resource-btn">模拟资源加载</button>
            <button id="webVitalsBtn" class="performance-btn">测试 Web Vitals</button>
        </div>

        <div class="demo-section">
            <h3>控制台输出</h3>
            <p>打开浏览器控制台查看详细的监控日志和上报数据。</p>
            <div class="performance-info">
                <strong>可用的测试函数：</strong><br>
                • window.testPerformance() - 手动测试性能监控<br>
                • window.testError() - 手动测试错误监控<br>
                • window.hawkTracker - 访问 Hawk Tracker 实例
            </div>
        </div>
    </div>

    <script type="module" src="./index.js"></script>
    <script>
        // 页面加载完成后显示性能信息
        window.addEventListener('load', () => {
            setTimeout(() => {
                const performanceInfo = document.getElementById('performanceInfo');
                const navigation = performance.getEntriesByType('navigation')[0];
                const paintEntries = performance.getEntriesByType('paint');
                
                const firstPaint = paintEntries.find(entry => entry.name === 'first-paint');
                const firstContentfulPaint = paintEntries.find(entry => entry.name === 'first-contentful-paint');
                
                performanceInfo.innerHTML = `
                    <strong>页面性能指标：</strong><br>
                    <div class="metric-item">
                        <span class="metric-label">页面加载时间：</span>
                        <span class="metric-value">${Math.round(navigation.loadEventEnd - navigation.fetchStart)}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">DOM 内容加载：</span>
                        <span class="metric-value">${Math.round(navigation.domContentLoadedEventEnd - navigation.fetchStart)}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">首次绘制：</span>
                        <span class="metric-value">${firstPaint ? Math.round(firstPaint.startTime) : 'N/A'}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">首次内容绘制：</span>
                        <span class="metric-value">${firstContentfulPaint ? Math.round(firstContentfulPaint.startTime) : 'N/A'}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">DNS 查询时间：</span>
                        <span class="metric-value">${Math.round(navigation.domainLookupEnd - navigation.domainLookupStart)}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">TCP 连接时间：</span>
                        <span class="metric-value">${Math.round(navigation.connectEnd - navigation.connectStart)}ms</span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">请求响应时间：</span>
                        <span class="metric-value">${Math.round(navigation.responseEnd - navigation.requestStart)}ms</span>
                    </div>
                `;
            }, 1000);
        });

        // 错误测试按钮
        const errorBtn = document.getElementById('errorBtn');
        errorBtn.addEventListener('click', () => {
            try {
                // 创建一个真实的错误
                const obj = {};
                obj.nonExistentMethod();
            } catch (error) {
                console.log('错误触发成功：', error);
            }
        });

        // 性能测试按钮
        const performanceBtn = document.getElementById('performanceBtn');
        performanceBtn.addEventListener('click', () => {
            console.log('手动触发性能数据收集...');
            const navigation = performance.getEntriesByType('navigation')[0];
            console.log('当前页面性能数据：', {
                loadTime: navigation.loadEventEnd - navigation.fetchStart,
                domContentLoaded: navigation.domContentLoadedEventEnd - navigation.fetchStart,
                firstPaint: performance.getEntriesByType('paint').find(entry => entry.name === 'first-paint')?.startTime
            });
        });

        // 资源加载测试按钮
        const resourceBtn = document.getElementById('resourceBtn');
        resourceBtn.addEventListener('click', () => {
            console.log('模拟资源加载...');
            const img = new Image();
            img.src = 'https://via.placeholder.com/300x200?text=Test+Resource';
            img.onload = () => {
                console.log('资源加载完成');
            };
        });

        // Web Vitals 测试按钮
        const webVitalsBtn = document.getElementById('webVitalsBtn');
        webVitalsBtn.addEventListener('click', () => {
            console.log('测试 Web Vitals...');
            
            // 测试 LCP (最大内容绘制)
            if ('PerformanceObserver' in window) {
                const observer = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    console.log('LCP (最大内容绘制)：', lastEntry.startTime);
                });
                observer.observe({ entryTypes: ['largest-contentful-paint'] });
            }
            
            // 测试 FID (首次输入延迟)
            if ('PerformanceObserver' in window) {
                const observer = new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const firstInput = entries[0];
                    console.log('FID (首次输入延迟)：', firstInput.processingStart - firstInput.startTime);
                });
                observer.observe({ entryTypes: ['first-input'] });
            }
        });

        // 添加全局测试函数
        window.testPerformance = () => {
            console.log('手动测试性能监控...');
            const navigation = performance.getEntriesByType('navigation')[0];
            const paintEntries = performance.getEntriesByType('paint');
            
            const performanceData = {
                loadTime: navigation.loadEventEnd - navigation.fetchStart,
                domContentLoaded: navigation.domContentLoadedEventEnd - navigation.fetchStart,
                firstPaint: paintEntries.find(entry => entry.name === 'first-paint')?.startTime || 0,
                firstContentfulPaint: paintEntries.find(entry => entry.name === 'first-contentful-paint')?.startTime || 0,
                dnsTime: navigation.domainLookupEnd - navigation.domainLookupStart,
                tcpTime: navigation.connectEnd - navigation.connectStart,
                requestTime: navigation.responseEnd - navigation.requestStart,
            };
            
            console.log('性能数据：', performanceData);
            return performanceData;
        };

        window.testError = () => {
            console.log('手动测试错误监控...');
            throw new Error('这是一个测试错误');
        };

        console.log('测试函数已添加到全局作用域：');
        console.log('  - window.testPerformance() - 手动测试性能监控');
        console.log('  - window.testError() - 手动测试错误监控');
        console.log('  - window.hawkTracker - 访问 Hawk Tracker 实例');
    </script>
</body>
</html>