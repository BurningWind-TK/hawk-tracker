# Hawk Tracker - 前端监控SDK项目

## 项目概述

Hawk Tracker 是一个功能完整的前端监控SDK系统，提供错误监控、性能监控和用户行为追踪能力。项目采用TypeScript开发，支持模块化插件系统。

## 核心功能

### 1. 错误监控 (Error Monitoring)
- **JavaScript错误捕获**: 自动捕获运行时错误、语法错误
- **Promise异常处理**: 监控未处理的Promise拒绝
- **资源加载错误**: 监控图片、CSS、JS等资源加载失败
- **网络请求错误**: 监控fetch、XHR请求失败和超时
- **错误去重机制**: 避免重复上报相同错误
- **错误上下文收集**: 包含堆栈信息、用户操作路径等

### 2. 性能监控 (Performance Monitoring) ⭐
- **页面加载性能**: 监控页面完整加载时间、DOM解析时间
- **Web Vitals核心指标**: LCP、FID、CLS等用户体验关键指标
- **资源加载监控**: 监控JS、CSS、图片等资源的加载性能
- **首次绘制时间**: FP (First Paint) 和 FCP (First Contentful Paint)
- **网络性能指标**: DNS解析、TCP连接、请求响应时间
- **实时性能观察**: 基于PerformanceObserver API的实时监控

### 3. 用户行为追踪 (Behavior Tracking)
- **点击事件监控**: 记录用户点击行为，支持节流和过滤
- **页面访问统计**: PV统计、页面停留时间分析
- **自定义事件追踪**: 支持业务自定义事件上报
- **行为栈管理**: 维护用户操作行为序列

### 4. 数据上报与存储
- **批量上报机制**: 支持数据批量发送，减少网络请求
- **离线缓存**: 网络异常时本地缓存数据，恢复后自动上报
- **失败重试**: 智能重试机制，支持指数退避算法
- **数据持久化**: 支持本地存储和服务器端存储

## 技术架构

### 1. Monorepo架构
-hawk-tracker/
-├── packages/ # SDK核心包
-│ ├── core/ # 核心功能包
-│ ├── plugin-error/ # 错误监控插件
-│ ├── plugin-performance/ # 性能监控插件 ⭐这里是我负责的性能监控模块⭐
-│ └── plugin-behavior/ # 行为监控插件
-├── apps/ # 演示应用
-│ ├── server/ # Koa.js数据接收服务
-│ ├── web/ # React监控展示平台
-│ └── vue3-monitor-demo/ # Vue3集成示例
-└── examples/ # 简单使用示例

### 2. 技术栈
- **开发语言**: TypeScript
- **构建工具**: Rollup + Vite + Turborepo
- **包管理**: PNPM Workspace
- **代码规范**: ESLint + Prettier + Husky
- **版本管理**: Changesets
- **服务端**: Koa.js + TypeScript
- **前端**: React + React Router v7 + Tailwind CSS

### 3. 插件系统设计
- **BasePlugin基类**: 统一的插件接口规范
- **事件中心**: 基于发布订阅模式的事件管理
- **数据发送器**: 统一的数据上报机制
- **配置管理**: 灵活的插件配置系统

## 安装部署流程

### 1. 环境要求
- Node.js >= 20
- PNPM >= 8.0
- 现代浏览器支持 (Chrome 51+, Firefox 55+, Safari 11+, Edge 79+)

### 2. 项目安装
```bash
# 克隆项目
git clone <repository-url>
cd hawk-tracker

# 安装依赖
pnpm install

# 构建所有包
pnpm build
```

### 3. 开发环境启动
```bash
# 启动所有服务 (开发模式)
pnpm dev

# 或分别启动
# 启动Server (端口3001)
cd apps/server
pnpm build && node dist/index.js

# 启动Web (端口3000)
cd apps/web
pnpm dev

# 启动Vue3示例 (端口5173)
cd apps/vue3-monitor-demo
pnpm dev
```

### 4. 生产环境部署
```bash
# 构建生产版本
pnpm build

# 启动生产服务
cd apps/server
NODE_ENV=production node dist/index.js
```

### 5. SDK集成使用
```typescript
// 基础使用
import { init } from '@hawk-tracker/core';
import { ErrorPlugin } from '@hawk-tracker/plugin-error';
import { PerformancePlugin } from '@hawk-tracker/plugin-performance';

// 初始化SDK
const tracker = init({
  dsn: 'https://your-server.com/api/collect',
  debug: true,
  sampleRate: 1.0
});

// 注册插件
tracker.use(ErrorPlugin);
tracker.use(PerformancePlugin);

// 手动上报事件
tracker.track('custom-event', {
  eventName: 'user-action',
  data: { userId: '123' }
});
```

### 6. 配置说明
```typescript
interface HawkTrackerConfig {
  dsn: string;                    // 数据上报地址
  debug?: boolean;               // 调试模式
  sampleRate?: number;           // 采样率 (0-1)
  batchSize?: number;            // 批量上报大小
  sendInterval?: number;         // 上报间隔(ms)
  maxRetry?: number;             // 最大重试次数
  offlineStorageKey?: string;    // 离线存储键名
  ignoreErrors?: RegExp[];       // 忽略的错误模式
  ignoreRequest?: RegExp[];      // 忽略的请求模式
}
```

## 项目特色

### 1. 高性能设计
- **轻量级**: 核心包仅约15KB (gzipped)
- **按需加载**: 支持插件按需引入
- **异步处理**: 所有监控操作不阻塞主线程

### 2. 高可用性
- **错误隔离**: 监控代码异常不影响业务代码
- **降级处理**: 不支持的环境自动降级
- **离线支持**: 网络异常时本地缓存数据

## 演示地址

- **Web监控平台**: http://localhost:3000
- **API服务**: http://localhost:3001
- **Vue3示例**: http://localhost:5173      这里是组内成员弄的示例

## 文档资源

- **完整API文档**: ./packages/plugin-performance/README.md
- **系统架构文档**: ./SYSTEM_DOCUMENTATION.md
- **技术栈说明**: ./技术栈.md
- **功能模块说明**: ./功能.md

# 个人项目贡献介绍 - Plugin Performance 性能监控模块

## 个人简介
负责Hawk Tracker项目中**plugin-performance性能监控模块**的完整设计与实现，该模块是前端监控SDK的核心组件之一，负责收集和分析Web应用的性能数据。

## 核心贡献

### 1. 性能监控插件架构设计
- **插件基类继承**: 基于`BasePlugin`基类设计，实现统一的插件接口规范
- **事件驱动架构**: 通过事件中心(`EventCenter`)实现插件与核心系统的解耦
- **配置管理系统**: 设计灵活的配置选项，支持运行时动态调整监控策略
- **生命周期管理**: 实现完整的插件安装、卸载和状态管理机制

### 2. 核心性能指标实现

#### 2.1 页面加载性能监控
```typescript
// 实现的关键指标
- 页面加载时间 (Load Time)
- DOM内容加载时间 (DOM Content Loaded)  
- 首次绘制时间 (First Paint)
- 首次内容绘制时间 (First Contentful Paint)
- DNS解析时间、TCP连接时间、请求响应时间
- DOM解析时间、DOM就绪时间
- 重定向时间、安全连接时间
```

#### 2.2 Web Vitals核心指标
```typescript
// 基于PerformanceObserver API实现
- LCP (Largest Contentful Paint): 最大内容绘制时间
- FID (First Input Delay): 首次输入延迟  
- CLS (Cumulative Layout Shift): 累积布局偏移
```

#### 2.3 资源加载性能监控
```typescript
// 支持监控的资源类型
- JavaScript文件、CSS样式文件
- 图片资源、字体文件
- API请求 (fetch、XMLHttpRequest)
- 动态加载的资源
```

### 3. 技术实现亮点

#### 3.1 高性能数据收集
- **PerformanceObserver API**: 利用现代浏览器原生API实现实时性能监控
- **异步数据处理**: 所有性能数据收集操作均为异步，不阻塞主线程
- **内存优化**: 实现观察器自动清理机制，避免内存泄漏
- **错误容错**: 完善的异常处理，确保监控代码不影响业务功能

#### 3.2 智能数据过滤
```typescript
// 资源类型过滤
private shouldMonitorResource(initiatorType: string): boolean {
  const monitoredTypes = ['script', 'css', 'img', 'fetch', 'xmlhttprequest'];
  return monitoredTypes.includes(initiatorType);
}

// 性能阈值配置
interface PerformanceThresholds {
  loadTime?: number;        // 页面加载时间阈值
  lcp?: number;            // LCP阈值
  fid?: number;            // FID阈值  
  cls?: number;            // CLS阈值
}
```

#### 3.3 数据上报优化
- **批量上报**: 支持性能数据批量收集和上报，减少网络请求
- **数据压缩**: 优化数据结构，减少传输数据量
- **实时监控**: 关键指标实时上报，非关键指标延迟上报
- **离线缓存**: 网络异常时本地缓存性能数据

### 4. 代码质量与规范

#### 4.1 TypeScript类型系统
```typescript
// 完整的类型定义
export interface PerformanceData {
  type: 'navigation' | 'dom_ready' | 'web_vitals' | 'resource';
  timestamp: number;
  loadTime?: number;
  firstPaint?: number;
  // ... 更多性能指标类型定义
}

export interface PerformanceOptions {
  enableWebVitals?: boolean;
  enableResourceTiming?: boolean;
  enableNavigationTiming?: boolean;
  performanceThresholds?: PerformanceThresholds;
}
```

### 5. 性能优化贡献

#### 5.1 监控性能优化
- **观察器复用**: 避免重复创建PerformanceObserver实例
- **数据采样**: 支持配置采样率，减少数据收集频率
- **内存管理**: 实现观察器自动清理和资源释放

#### 5.2 用户体验优化
- **无感知监控**: 监控过程对用户完全透明
- **渐进增强**: 不支持的环境自动降级，不影响基础功能
- **调试友好**: 提供详细的调试日志和状态查询接口


